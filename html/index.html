<!DOCTYPE html>

<html>

<head>
	<meta charset='utf-8' />
	<title>M-Lab hexbinned maps using Turf.js</title>
	<meta name='viewport' content='width=device-width, initial-scale=1.0, maximum-scale=1.0, user-scalable=no' />
	<link href='https://api.tiles.mapbox.com/mapbox.js/v2.1.6/mapbox.css' rel='stylesheet' />
	<link href='mlab.css' rel='stylesheet' />
	<script src='https://api.tiles.mapbox.com/mapbox.js/v2.1.6/mapbox.js'></script>
	<script src='mlab.js'></script>
	<script src='center.js'></script>
</head>

<body>

<div id="spinner">
	<div id="spin">&nbsp;</div>
	<div id="loading">LOADING</div>
</div>

<div id='map'></div>

<script>

// Default hex layer data file
var defaultDataUrl = "default.geojson";

// Center and zoom level of map.  center should be pulled in via center.js, but
// if not then just set it to the center of the USA
if ( typeof center == 'undefined' ) {
	var center = [38.8961302513129,-99.04025268554688]; //USA
}
var zoom = 4;

// Create the map
var map = L.map('map').setView(center, zoom);

var osmLayer = L.tileLayer('http://{s}.tile.osm.org/{z}/{x}/{y}.png', {
	attribution: '&copy; <a href="http://osm.org/copyright">OpenStreetMap</a> contributors'
})

var mapboxLayer = L.tileLayer('https://{s}.tiles.mapbox.com/v3/newamerica.lcl1jan5/{z}/{x}/{y}.png', {
	attribution: '&copy; <a href="http://mapbox.com/">Mapbox</a>'
})

// Set the default base tile layer
map.addLayer(osmLayer);

// Add other base tile layer providers as needed
var baseLayers = {
	"OpenStreetMap" : osmLayer,
	"Mapbox" : mapboxLayer
}

L.control.layers(baseLayers).addTo(map);
getHexLayer(defaultDataUrl, 'download_avg', 'low');
addLegend();

</script>

<div id="controls">

	<form id="selectDate" name="selectDate" action="#">
		<select name="date" onchange="updateHexLayer(this.value, document.forms.selectMetric.metric.value, document.forms.selectRes.resolution.value);">
			<option value="geojson/2014_01-RESOLUTION.geojson">Jan 2014</option>
			<option value="geojson/2014_02-RESOLUTION.geojson">Feb 2014</option>
			<option value="geojson/2014_03-RESOLUTION.geojson">Mar 2014</option>
			<option value="geojson/2014_04-RESOLUTION.geojson">Apr 2014</option>
			<option value="geojson/2014_05-RESOLUTION.geojson">May 2014</option>
			<option value="geojson/2014_06-RESOLUTION.geojson">Jun 2014</option>
			<option value="geojson/2014_07-RESOLUTION.geojson">Jul 2014</option>
			<option value="geojson/2014_08-RESOLUTION.geojson">Aug 2014</option>
			<option value="geojson/2014_09-RESOLUTION.geojson">Sep 2014</option>
			<option value="geojson/2014_10-RESOLUTION.geojson">Oct 2014</option>
			<option value="geojson/2014_11-RESOLUTION.geojson">Nov 2014</option>
			<option value="geojson/2014_12-RESOLUTION.geojson">Dec 2014</option>
		</select>
	</form>

	<form id="selectMetric" name="selectMetric" action="#" style="float: left;">
		<select name="metric"
			onchange="updateHexLayer(document.forms.selectDate.date.value, this.value, document.forms.selectRes.resolution.value);">
			<option value="download_avg">Download throughput</option>
			<option value="upload_avg">Upload throughput</option>
			<!-- TODO: Add ability to map counts
			<option value="download_count">Test count</option>
			-->
		</select>
	</form>

	<form id="selectRes" name="selectRes" action="#">
		<select name="resolution" onchange="updateHexLayer(document.forms.selectDate.date.value, document.forms.selectMetric.metric.value, this.value);">
			<option value="low">Low</option>
			<option value="medium">Medium</option>
			<option value="high">High</option>
		</select>
	</form>


</div>

</body>

</html>
